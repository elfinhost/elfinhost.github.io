"use strict";(self.webpackChunkreact_app_ts=self.webpackChunkreact_app_ts||[]).push([[77],{6077:function(e,s,a){a.r(s),a.d(s,{default:function(){return f}});var n,i,t,r=a(9439),c=a(168),l=a(390),h=(a(5379),{page:"MoblieLearn_page__Md-DS",header:"MoblieLearn_header__2Bn2O",image_2:"MoblieLearn_image_2__fSSDc",pos:"MoblieLearn_pos__s1oe8","space-x-6":"MoblieLearn_space-x-6__kZTj7",image:"MoblieLearn_image__AwXGd",font_1:"MoblieLearn_font_1__gxoOW",text:"MoblieLearn_text__pUUw2",group:"MoblieLearn_group__JQbpE",text_2:"MoblieLearn_text_2__g1qmn",group_2:"MoblieLearn_group_2__NFQN3",font_2:"MoblieLearn_font_2__LHyKP",font_3:"MoblieLearn_font_3__JBpnU",font_4:"MoblieLearn_font_4__12anh",button:"MoblieLearn_button__Hsz88",image_3:"MoblieLearn_image_3__oioPc",text_3:"MoblieLearn_text_3__E-3ym",text_4:"MoblieLearn_text_4__CYKau",group_3:"MoblieLearn_group_3__Mcww4","space-y-80":"MoblieLearn_space-y-80__gtFMV",section:"MoblieLearn_section__t755b","text-wrapper":"MoblieLearn_text-wrapper__P8HOG",text_5:"MoblieLearn_text_5__zY6yD",divider:"MoblieLearn_divider__Mz6rR",group_4:"MoblieLearn_group_4__75St-",view:"MoblieLearn_view__DjAvK","text-wrapper_2":"MoblieLearn_text-wrapper_2__eiJA9",font_5:"MoblieLearn_font_5__UazvF",text_6:"MoblieLearn_text_6__yPjIJ",image_4:"MoblieLearn_image_4__eMLmv",view_2:"MoblieLearn_view_2__-DhT3",section_2:"MoblieLearn_section_2__IfKc4","space-y-14":"MoblieLearn_space-y-14__dsraB",image_5:"MoblieLearn_image_5__fVN1a",text_7:"MoblieLearn_text_7__0BzYH",group_5:"MoblieLearn_group_5__2EGWn",group_6:"MoblieLearn_group_6__r6lZI",text_8:"MoblieLearn_text_8__SiiXF",group_7:"MoblieLearn_group_7__cmtq+",font_6:"MoblieLearn_font_6__ifT7y",group_8:"MoblieLearn_group_8__aCDlc",image_6:"MoblieLearn_image_6__d06l2",group_9:"MoblieLearn_group_9__8RKv1",group_10:"MoblieLearn_group_10__sVnyw",group_11:"MoblieLearn_group_11__lmwXP",group_12:"MoblieLearn_group_12__vMlyo",group_13:"MoblieLearn_group_13__zbWP+",group_14:"MoblieLearn_group_14__p6nOs",group_15:"MoblieLearn_group_15__rSPKL","space-x-4":"MoblieLearn_space-x-4__ZWI57",grid:"MoblieLearn_grid__mKy5A","grid-item":"MoblieLearn_grid-item__esN7g","space-y-24":"MoblieLearn_space-y-24__2LByA",image_7:"MoblieLearn_image_7__L51QQ",image_8:"MoblieLearn_image_8__z82Ze","grid-item_2":"MoblieLearn_grid-item_2__BN45x","space-x-8":"MoblieLearn_space-x-8__g8ZXX",image_9:"MoblieLearn_image_9__MT-Bc",image_10:"MoblieLearn_image_10__8BjQ8",group_16:"MoblieLearn_group_16__ZcL3G","space-x-32":"MoblieLearn_space-x-32__RZ0rm",image_11:"MoblieLearn_image_11__TTQvu",image_12:"MoblieLearn_image_12__dO7nG",styleError:"MoblieLearn_styleError__ko0Vd"}),d=a(5545),o=a(9477),p=a(5009),m=a(3355),x=a(2559),j=p.ZP.button(n||(n=(0,c.Z)(["\n    width: 3rem;\n    height: 0.56rem;\n    background: linear-gradient(154deg,#36d0ac, #60f770 100%);\n    border-radius: 0.08rem;\n    font-size: 0.2rem;\n    font-weight: 500;\n    color: #ffffff;\n    line-height: 0.24rem;\n\n"]))),u=p.ZP.button(i||(i=(0,c.Z)(["\n    width: 1.2rem;\n    height: 1.2rem;\n    background: #ffffff;\n    border-radius: 50%;\n    box-shadow: 0rem 0.01rem 0.12rem -0.01rem rgba(0,0,0,0.50); \n    position: fixed;\n    right: 0.44rem;\n    bottom: 0.53rem;\n    display:flex;\n    align-items:center ;\n    justify-content:center ;\n"]))),N=(0,p.ZP)(m.ZP)(t||(t=(0,c.Z)(["\n     .title{\n        height: 0.47rem;\n        font-size: 0.4rem;\n        font-family: Roboto, Roboto-Bold;\n        font-weight: 700;\n        text-align: center;\n        color: #000000;\n        line-height: 0.47rem;\n     }\n\n     .line{\n        width: 100%;\n        height: 0.01rem;\n        background: #e7e7e7;\n        margin-top:0.24rem ;\n     }\n\n     .item{\n        cursor: pointer;\n        /* width: 4.28rem; */\n        background: #f4f4f4;\n        font-size: 0.24rem;\n        font-family: Roboto, Roboto-Regular;\n        font-weight: 400;\n        text-align: left;\n        color: #000000;\n        line-height: 0.32rem;\n        letter-spacing: 0rem;\n        width:100% ;\n        .conent{\n            word-break: break-all;\n            font-size: 0.24rem;\n        }\n     }\n   \n     .activebg{\n        background: linear-gradient(135deg,#36d0ac, #60f770);\n        color:#fff;\n     }\n     .MuiDrawer-paper{\n        width: 4.8rem;\n     }\n"]))),f=function(){var e=(0,d.UO)().activeId,s=(0,d.s0)(),a={Protocol:0,Authorizer:1,Recryptor:2,Directory:3,Adapter:4,Payment:5};(0,l.useEffect)((function(){c(a[e||"Protocol"])}),[e]);var n=(0,l.useState)(a[e||"Protocol"]),i=(0,r.Z)(n,2),t=i[0],c=i[1],p=(0,l.useState)(!1),m=(0,r.Z)(p,2),f=m[0],g=m[1];(0,l.useEffect)((function(){var e=document.createElement("link");e.rel="stylesheet",e.href="/css/pygments.css",document.head.appendChild(e);var s=document.createElement("link");return s.rel="stylesheet",s.href="/css/learnDocRem.module.css",document.head.appendChild(s),setTimeout((function(){g(!0)}),500),function(){document.head.removeChild(s),document.head.removeChild(e)}}),[]);var y=(0,l.useState)(!1),b=(0,r.Z)(y,2),v=b[0],k=b[1];return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"".concat(f?"visible":"invisible"," flex-col ").concat(h.page),children:[(0,x.jsx)(u,{onClick:function(){k(!0)},children:(0,x.jsx)("img",{className:"w-[0.53rem] h-[0.53rem]",src:"image/750/learn/\u76ee\u5f55.svg"})}),(0,x.jsxs)(N,{anchor:"right",open:v,onClose:function(){k(!1)},children:[(0,x.jsx)("div",{className:"title  mt-[0.24rem] text-[0.4rem] text-center",children:"ON THIS WHITEPAPER"}),(0,x.jsx)("div",{className:"line"}),["ElfinGuard Access-Control Protocol","Elfin Authorizer","Elfin Recryptor","Elfin Directory","UTXO Adapter","BCH Payment Judgers"].map((function(e,n){return(0,x.jsxs)("div",{onClick:function(){s("/Learn/".concat(Object.keys(a)[n])),window.scrollTo({top:0})},className:"".concat(t==n?"activebg":""," mt-[0.16rem] flex pr-[0.08rem] pl-[0.16rem] pb-[0.15rem] pt-[0.15rem] h-[0.91rem] item items-center justify-center"),children:[(0,x.jsxs)("div",{children:[n+1,"."]}),(0,x.jsx)("div",{className:"ml-[0.13rem] w-[88%] conent",children:e})]},e)}))]}),(0,x.jsx)("div",{className:"flex-col flex-auto ".concat(h.group),children:(0,x.jsx)("div",{className:"".concat(h.group_2),children:(0,x.jsxs)("div",{id:"scrollPanel",className:"text-[0.24rem] rst-content flex flex-1 flex-col  ".concat(h.conent_panel),children:[0===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"ElfinGuard Access-Control Protocol"}),(0,x.jsxs)("div",{style:{flexShrink:"unset"},className:"section",id:"elfinguard-access-control-protocol",children:[(0,x.jsxs)("h1",{children:["ElfinGuard Access-Control Protocol",(0,x.jsx)("a",{className:"headerlink",href:"#elfinguard-access-control-protocol",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Today users can store information with the help of Decentralized File Hosting. However, decentralizing the storage is not enough. In order to ensure full protection, users need an access-control protocol."}),(0,x.jsx)("p",{children:"We aim to add this missing link by combining the power of decentralized storage with advanced access control. ElfinGuard is revolutionizing the way users protect their data."}),(0,x.jsxs)("div",{className:"section",id:"the-value-of-access-control",children:[(0,x.jsxs)("h2",{children:["The Value of Access-Control",(0,x.jsx)("a",{className:"headerlink",href:"#the-value-of-access-control",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Web 2.0 relies heavily on file hosting in tandem with content delivery networks (CDNs) to deliver multimedia contents to users.  Authors spend time and effort to create the content, and it costs them storage and bandwidth resources to deliver it to their target users. Authors and Delivery services earn revenue from end users, either directly (fees) or indirectly (advertisement). The Web 2.0 era has generated multiple centralized methods to directly control access to these contents; businesses can not profit if users can extract any content without permission."}),(0,x.jsx)("p",{children:"Web 3.0 has seemingly solved the problem of centralized file storage; solutions such as IPFS, Filecoin, Swarm and Arweave offer decentralized file storage. However, this technology only incentivizes storage providers. There is no earning opportunity for authors and deliverers by using decentralized file storage solutions as there are no access-control methods."}),(0,x.jsx)("p",{children:"Blockchains build an internet of value, smart contracts enable programmable value, but can the traditional internet of information be built with blockchains as well?  Can smart contracts facilitate information accessing? ElfinGuard answers both these questions."}),(0,x.jsx)("p",{children:"ElfinGuard\u2019s access-control protocol allows authors to program who, how and when the usesrs can access content on decentralized storages. This technology will pave the way for new blockchain-oriented business models."}),(0,x.jsx)("p",{children:"ElfinGuard\u2019s access-control protocol has the following innovative features:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Hardware-based protection; making it more reliable than law, morality,\xa0discipline, or human-controlled permissions."}),(0,x.jsx)("li",{children:"Easily programmable with solidity; authorization is based on smart contracts and on-chain states."}),(0,x.jsx)("li",{children:"No single-point of failure; content delivery and authorization are decentralized."})]}),(0,x.jsx)("p",{children:"This article introduces the protocol step-by-step.  Each step will refine the granularity of the solution, ultimately providing a comprehensive understanding of this innovative technology."})]}),(0,x.jsxs)("div",{className:"section",id:"enforced-permissions-on-public-data",children:[(0,x.jsxs)("h2",{children:["Enforced Permissions on Public Data",(0,x.jsx)("a",{className:"headerlink",href:"#enforced-permissions-on-public-data",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"While there isn\u2019t a common definition of Web 3.0, most people believe it will empower users to control their own data, enjoy greater privacy and prevent centralized platforms from monopolizing the acquisition, recommendation, and censorship of their information. Thus, the decentralization of data storage and data delivery are key cornerstones of Web 3.0."}),(0,x.jsx)("p",{children:"Today, decentralized storage is easily accessible.  The solutions, such as IPFS, have made significant strides in enabling users to store and deliver the content. For example, users can pin a video on IPFS with multiple utilities.  However, delivering the content efficiently and smoothly to all viewers still remains challenging. This is where centralized platforms provide the most value as they ensure smooth delivery to a mass audience."}),(0,x.jsx)("p",{children:"As content becomes more sophisticated, it requires larger file size to contain high-resolution pictures, articles with tables & figures, and large audio & video content, which are expensive to transfer, even more so than to store them. This is because the cost of bandwidth is higher than that of storage.  Content delivery networks (CDNs) can help reduce the bandwidth cost by caching data in edge nodes that are close to the target audience."}),(0,x.jsx)("p",{children:"In the Web 3.0 era, users still need CDNs. However, CDN providers only serve websites that pay them.  Providers use the \u201csame origin policy\u201d to decide whether to serve a request.  If website B contains an image or video from website A, the CDN provider will not serve B by providing A\u2019s contents."}),(0,x.jsx)("p",{children:"Decentralized storage schemes, on the other hand, do not explicitly reveal a file\u2019s origin or constrain access to files based on the \u201csame origin policy.\u201d  Thus, users can only encourage CDN providers to serve permissionless data to the public, i.e., ignore which website or App is requesting the data, which severely limits the use cases for authors."}),(0,x.jsx)("p",{children:"This is where ElfinGuard comes in. ElfinGuard allows authors to create enforceable permissions on public content in decentralized storages and ensures only their target audience can access that content."}),(0,x.jsx)("p",{children:"Encryption enclaves plays a critical role in helping authors secure their content and reach the target audience .  Encryption enclaves connect to each other and share one symmetric key for encryption/decryption.  This key is generated inside one encryption enclave and broadcasted to others through secure channels, and hardware enclaves protect the symmetric key.  An original file, together with its target audience\u2019s addresses, is encrypted into one file via an encryption enclave. The encrypted file is then stored on IPFS."}),(0,x.jsx)("p",{children:"When a user requests the original file, a CDN provider fetches the encrypted data and uses an encryption enclave to decrypt it.  The enclave will then check if the requester\u2019s address is listed as the file\u2019s target audience. If so, it decrypts the file and the CDN provider sends the original file to the requester."})]}),(0,x.jsxs)("div",{className:"section",id:"end-to-end-encryption",children:[(0,x.jsxs)("h2",{children:["End-to-end encryption",(0,x.jsx)("a",{className:"headerlink",href:"#end-to-end-encryption",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"On Web 2.0 platforms users can update original files without any encryption.  As a result, these files can be vulnerable to being leaked to the public or malicious attackers, even if users request a platform to keep them private.  Most Platforms are required by law and company rule to have an active privacy disclosure, but the uploaded files must be stored in databases, which use human-controlled permissions to limit access.  Software vulnerabilities and human errors or unfaithfulness can still result in data leaks, despite a platform\u2019s best efforts to enact privacy disclosure."}),(0,x.jsx)("p",{children:"Moreover, operators on a CDN provider\u2019s backend can view any content, regardless of the access constraint of the actual website it serves.  In our above example, the CDN provider can keep a copy of the decrypted file against the author\u2019s will."}),(0,x.jsx)("p",{children:"The solution to these issues is upgrading encryption enclaves to \u201cre-cryptors\u201d.  A re-cryptor takes an encrypted file as an input, decrypts it into the original content, and finally re-encrypts it with another distinct key."}),(0,x.jsx)("p",{children:"When an author wants a re-cryptor to encrypt a file before uploading it to IPFS, he or she must encrypt the original file beforehand with a shared secret that is only known to them and the re-cryptor.  When a user requests a re-cryptor to decrypt a file from IPFS, he or she will get a file encrypted with the shared secret, not the original file."}),(0,x.jsx)("p",{children:"During the whole process of storing and delivering, only the inside logic of the re-cryptor enclave can access the original content, and the usage of hardware enclaves ensures it will never be leaked.  Therefore, other than the author and the target audience, no other humans from the platform or CDN provider can view the original content."})]}),(0,x.jsxs)("div",{className:"section",id:"authorization-contracts",children:[(0,x.jsxs)("h2",{children:["Authorization contracts",(0,x.jsx)("a",{className:"headerlink",href:"#authorization-contracts",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Traditionally, CDN providers require authorization servers to provide sophisticated dynamic access control.  Authorization servers are typically created by a CDN provider\u2019s customer.  For example, if Bob requests to view a URL of website A, the CDN provider will ask the website A\u2019s authorization server whether Bob is authorized to view the URL.  The website A may allow Bob to view it if he is a VVIP, or make Bob wait until Friday if he is a VIP, or deny Bob if he is neither.  However, in the Web 3.0 era, authors need a more streamlined way for dynamic access control as running an authorization server is too complicated and time consuming for ordinary authors."}),(0,x.jsxs)("p",{children:["One solution to this problem is to use on-chain Smart Contracts for dynamic access control.  For instance, an author may choose to restrict access to their content to only holders of specific NFTs or ERC20 tokens.  A re-cryptor then uses an ",(0,x.jsx)("cite",{children:"eth_call"})," to invoke a smart contract\u2019s function with the requestor\u2019s address as the argument, if it returns \u201ctrue\u201d then the requestor is granted access.  The file uploaded to IPFS specifies which contracts to call and how to call them, rather than a static set of target audience. This approach provides authors with a more efficient and effective way to manage dynamic access control."]})]}),(0,x.jsxs)("div",{className:"section",id:"multi-grant-from-authorities",children:[(0,x.jsxs)("h2",{children:["Multi-Grant from Authorities",(0,x.jsx)("a",{className:"headerlink",href:"#multi-grant-from-authorities",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["When a re-cryptor requires ",(0,x.jsx)("cite",{children:"eth_call"})," for authorization, there\u2019s a potential for \u2018Witch Attacks\u2019 to occur.  To query ",(0,x.jsx)("cite",{children:"eth_call"}),", users need a blockchain node to provide RPC endpoints.  A node can be run by a user, but in most cases the user will rent a node from a Node-as-a-Service (NaaS) provider."]}),(0,x.jsxs)("p",{children:["Although the re-cryptors\u2019 internal data and logic are safe under the protection of enclaves, the input data the re-cryptor receives through ",(0,x.jsx)("cite",{children:"eth_call"})," may be incorrect \u2013 this can be for various reasons.  A CDN provider may receive incorrect information from a NaaS provider due to incorrect configuration of the re-cryptor\u2019s DNS and TLS settings.  A node run by a CDN provider may also return incorrect information if it is hacked because of vulnerabilities.  Any CDN provider may have security problems; thus, trusting one single CDN provider is problematic for content authors."]}),(0,x.jsxs)("p",{children:["To address this issue, the solution is to separate the task of authorization out from the re-cryptors and use dedicated Authorizers to query ",(0,x.jsx)("cite",{children:"eth_call"}),".  These authorizers are run by several trustworthy authorities and have strong security measures and good reputations."]}),(0,x.jsx)("p",{children:"To further protect the symmetric key, we use a \u201cmulti-grant\u201d scheme which is like that of \u201cmulti-signature.\u201d The content creator specifies an \u201cN\u201d number of authorities and a threshold number \u201cM\u201d (M < N).  Before uploading, the re-cryptor must encrypt the original file with all \u201cN\u201d grant codes.  In tandem, before the re-cryptor decrypts a file for a requestor, the requestor must collect at least \u201cM\u201d grant codes from the specified authorities."}),(0,x.jsx)("p",{children:"All Authorizers run by the same authority have the same \u201cgrant root\u201d.  For each individual file, an authorizer derives a unique grant code from the grant root, after it ensures the requestor is allowed access to the file. The derived grant root is generated inside enclaves and shared amongst enclaves, ensuring that even an operator employed by the authority cannot view the root value.  The grant codes are sent from authorizers to re-cryptors through secure channels which prevent any third party from viewing them.  To ensure grant codes are sent only to trustable enclaves, authorizers always check with the re-cryptors before opening secure channels."}),(0,x.jsx)("p",{children:"(The encryption/decryption algorithm for \u201cmulti-grant\u201d will be introduced in a separate article.)"})]}),(0,x.jsxs)("div",{className:"section",id:"multi-zone-to-mitigate-risks-of-enclaves-vulnerabilities",children:[(0,x.jsxs)("h2",{children:["Multi-zone to mitigate risks of enclaves\u2019 vulnerabilities",(0,x.jsx)("a",{className:"headerlink",href:"#multi-zone-to-mitigate-risks-of-enclaves-vulnerabilities",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Enclaves are integral to a system\u2019s security, but it still may be compromised if the underlying hardware has vulnerabilities.  Despite there have been no real attacks reported on CPUs with hyperthreading disabled, the risk of security breaches still exists."}),(0,x.jsx)("p",{children:"Currently, enclaves can be implemented using Intel\u2019s SGX & TDX, AMD\u2019s SEV-SNP, ARM\u2019s TEE, and AWS\u2019s Nitro.  SGX is the most mature and mainstream solution while the others are rapidly evolving.  Enclaves are divided into different zones, and each zone uses the same technology.  For example, all enclaves based on Intel SGX are in the same zone."}),(0,x.jsx)("p",{children:"The probability of all zones being simultaneously exploited by hackers is extremely low.  However, an author can further protect his or her file by splitting it into multiple parts, each of which is protected by a different enclave zone."}),(0,x.jsx)("p",{children:"For example, an author divides a file into three parts: Part #1 is protected by SGX enclaves, Part #2 by SEV-SNP enclaves, and Part #3 by AWS\u2019s Nitro enclaves.  This approach requires the audience to retrieve all three parts to recover the full original file."})]}),(0,x.jsxs)("div",{className:"section",id:"the-big-picture",children:[(0,x.jsxs)("h2",{children:["The Big Picture",(0,x.jsx)("a",{className:"headerlink",href:"#the-big-picture",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"ElfinGuard Access-Control Protocol uses smart contracts to manage file accessibility with following functions:"}),(0,x.jsx)("img",{alt:"image/PC/learn/flow.png",src:"image/PC/learn/flow.png"}),(0,x.jsx)("p",{children:"The author uses smart contracts to program file accessibility and uploads these files to re-cryptors run by CDN providers.  The re-cryptors encrypt files and store them in decentralized storage services."}),(0,x.jsx)("p",{children:"When the audience wants to view a file, they must connect to a re-cryptor that can retrieve the file out from the decentralized storages.  The re-cryptor will request the authorizer to grant file decryption.  When the re-cryptor decrypts the file, the audience can download it."}),(0,x.jsx)("p",{children:"The content author writes smart contracts to specify what audience behaviors or states on blockchains will be qualified to view the file.  In most cases the \u2018behavior\u2019 is a payment (audience pays the author directly with ERC20 tokens) and the \u2018state\u2019 is ownership of certain NFTs."}),(0,x.jsx)("p",{children:"To close the circle, an authorizor uses the blockchain\u2019s RPC nodes to determine whether to grant the decryption based on specified behaviors or states.  Once these processes are completed and verified, the author\u2019s intended audience can view the content."})]})]})]}),1===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"Elfin Authorizer"}),(0,x.jsxs)("div",{style:{flexShrink:"unset"},className:"section",id:"elfin-authorizer",children:[(0,x.jsxs)("h1",{children:["Elfin Authorizer",(0,x.jsx)("a",{className:"headerlink",href:"#elfin-authorizer",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"section",id:"blockchain-based-authorizing",children:[(0,x.jsxs)("h2",{children:["Blockchain-based Authorizing",(0,x.jsx)("a",{className:"headerlink",href:"#blockchain-based-authorizing",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"In the Web 2.0 era, account-based access control is very common. You must register to a website or App. Then it grants you a \u201clevel\u201d, such as Guest, VIP, SVIP, etc. With different levels, you have different service quality. For example, some high-quality contents are only available to VIP, and SVIP account can view a new TV show much earlier than a guest account."}),(0,x.jsx)("p",{children:"As we come into the Web 3.0 era, authorization based on blockchain accounts are more and more popular. Many websites and Apps support \u201clogin with Web3 wallets\u201d. But just login is not enough. We also want to use on-chain state to assign different levels to the accounts. When a website decides whether to provide a service to a specific account, it may want to consider:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Historical contract interaction. Did it even send transactions to call some contracts?"}),(0,x.jsx)("li",{children:"Historical events. Did it ever receive some ERC20 token or NFT?"}),(0,x.jsx)("li",{children:"The latest state of the account. Does it own some ERC20 token or NFT? Does it belong to some DAO?"})]}),(0,x.jsx)("p",{children:"These conditions can be AND-ed/OR-ed together to form more sophisticated conditions."}),(0,x.jsx)("p",{children:"Node-as-a-service (NaaS) providers runs plenty of nodes of different blockchains. Accessing on-chain state is a regular task for them. It would be very easy for them to add a new service: Elfin authorizers."}),(0,x.jsx)("p",{children:"Elfin authorizers can assign access permissions to accounts according to such sophisticated conditions. A website or App can outsource the permissioning task to them."}),(0,x.jsx)("p",{children:"Elfin authorizers are oracles which endorse facts by signing them using their private keys. This article introduces the different facts they can sign and how to express sophisticated conditions using these signed facts."}),(0,x.jsx)("div",{className:"section",id:"primitives-provided-by-authorizers",children:(0,x.jsxs)("h5",{children:["Primitives provided by authorizers",(0,x.jsx)("a",{className:"headerlink",href:"#primitives-provided-by-authorizers",title:"Permalink to this headline"})]})})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-historical-contract-interaction",children:[(0,x.jsxs)("h2",{children:["Endorse historical contract interaction",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-historical-contract-interaction",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"A historical transaction can be described by such a solidity struct:"}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"kt",children:"struct"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"TxInfo"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"{"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"chainId"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// which chain did this log happen on?"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"timestamp"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// when did this log happend at?"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"txid"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// the transaction's hash id"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"fromAccount"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"toAccount"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"value"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"callData"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:"p",children:"}"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                "]})})}),(0,x.jsxs)("p",{children:["If a transaction really happend in a blockchain\u2019s history, the Elfin authorizer generates a ",(0,x.jsx)("cite",{children:"TxInfo"})," struct to describe it. Then it uses ",(0,x.jsx)("cite",{children:"abi.encodePacked"})," to serialize this struct into raw bytes and sign the keccak256 hash of the raw bytes. In such a way it endorses this transaction using its private key."]})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-historical-events",children:[(0,x.jsxs)("h2",{children:["Endorse historical events",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-historical-events",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Events are implemented using EVM logs. A EVM log can be described by such a solidity struct:"}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"kt",children:"struct"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"LogInfo"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"{"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"chainId"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// which chain did this log happen on?"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"timestamp"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// when did this log happend at?"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"sourceContract"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// which contract generates this log?"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes32"}),(0,x.jsx)("span",{className:"p",children:"[]"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"topics",(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// a log has 0~4 topics"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"data"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// a log has variable-length data"}),"\n","                ",(0,x.jsx)("span",{className:"p",children:"}"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                "]})})}),(0,x.jsxs)("p",{children:["If a transaction really happend in a blockchain\u2019s history, the Elfin authorizer generates a ",(0,x.jsx)("cite",{children:"LogInfo"})," struct to describe it. Then it uses ",(0,x.jsx)("cite",{children:"abi.encodePacked"})," to serialize this struct into raw bytes and sign the keccak256 hash of the raw bytes. In such a way it endorses this event using its private key."]})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-the-outputs-of-eth-call",children:[(0,x.jsxs)("h2",{children:["Endorse the outputs of eth_call",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-the-outputs-of-eth-call",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["A requestor asks the Elfin authorizer to query the ",(0,x.jsx)("cite",{children:"eth_call"})," endpiont of Web3 RPC servers. The 16~35 bytes of the call data used for ",(0,x.jsx)("cite",{children:"eth_call"})," must equal the authorizer\u2019s EVM address calculated from its private key. The authorizer collects the related information about this ",(0,x.jsx)("cite",{children:"eth_call"})," to fill the following struct:"]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"kt",children:"struct"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"EthCallInfo"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"{"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"chainId"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"timestamp"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"fromAccount"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"targetContract"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),"bytes4",(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"functionSelector",(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"outData"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:"p",children:"}"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                "]})})}),(0,x.jsxs)("p",{children:["Then it uses ",(0,x.jsx)("cite",{children:"abi.encodePacked"})," to serialize this struct into raw bytes and sign the keccak256 hash of the raw bytes. In such a way it endorses the outputs of ",(0,x.jsx)("cite",{children:"eth_call"})," using its private key."]})]}),(0,x.jsxs)("div",{className:"section",id:"granting-secrets-to-account-owners",children:[(0,x.jsxs)("h2",{children:["Granting secrets to account owners",(0,x.jsx)("a",{className:"headerlink",href:"#granting-secrets-to-account-owners",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["A requestor asks the Elfin authorizer to query the ",(0,x.jsx)("cite",{children:"eth_call"})," endpiont of Web3 RPC servers. The 16~35 bytes of the call data used for ",(0,x.jsx)("cite",{children:"eth_call"})," must equal the authorizer\u2019s EVM address calculated from its private key. The from-account for ",(0,x.jsx)("cite",{children:"eth_call"})," must be the requestor\u2019s EVM address (a ",(0,x.jsx)("cite",{children:"personal_sign"})," signature is required to ensure this). The authorizer collects the related information about this ",(0,x.jsx)("cite",{children:"eth_call"})," to fill the following struct:"]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"kt",children:"struct"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"SecretSeed"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"{"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"chainId"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),"bytes4",(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"functionSelector",(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"targetContract"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"outData"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                ",(0,x.jsx)("span",{className:"p",children:"}"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n","                "]})})}),(0,x.jsxs)("p",{children:["Then it uses ",(0,x.jsx)("cite",{children:"abi.encodePacked"})," to serialize this struct into raw bytes and calculate the keccak256 hash of the raw bytes. With its private key and this hash, it generates a VRF (verifiable random function) output and a proof. The VRF output is a secret that only qualified requestor can get."]}),(0,x.jsx)("p",{children:"For granting secrets, authorizers also supports a recryptor mode, which requires the request comes from a recryptor\u2019s enclave. In the recryptor mode, the raw bytes\u2019 sha256 hash is used for VRF, instead of keccak256 hash."}),(0,x.jsxs)("div",{className:"section",id:"write-authorization-contract-to-express-sophisticated-conditions",children:[(0,x.jsxs)("h5",{children:["Write authorization contract to express sophisticated conditions",(0,x.jsx)("a",{className:"headerlink",href:"#write-authorization-contract-to-express-sophisticated-conditions",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Suppose we want to provide a file-sharing service only to such qualified accounts:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Someone who is explicitly marked as qualified member by a superuser"}),(0,x.jsx)("li",{children:"Someone who has called a contract and received a given ERC20 token in the recent two months"})]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"isQualified"})," function of the following ",(0,x.jsx)("cite",{children:"Membership"})," contract can check if ",(0,x.jsx)("cite",{children:"msg.sender"})," is a qualified account:"]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),'import "@openzeppelin/contracts/access/Ownable.sol";',"\n","\n","                ","struct Signature ","{","\n","                        ","uint8 v;","\n","                        ","bytes32 r;","\n","                        ","bytes32 s;","\n","                ","}","\n","\n","                ","contract Membership is Ownable ","{","\n","                    ","mapping(address => bool) public isMember;","\n","                    ","mapping(uint => bool) public forbiddenFiles;","\n","                    ","address immutable public erc20Token;","\n","                    ","address immutable public calledContract;","\n","                    ",'bytes32 constant private TransferEvent = keccak256("transfer(address,address,uint256)");',"\n","                    ",'string constant private PREFIX = "\\x19Ethereum Signed Message:\\n32";',"\n","\n","                    ","constructor(address _erc20Token, address _calledContract) Ownable() ","{","\n","                        ","erc20Token = _erc20Token;","\n","                        ","calledContract = _calledContract;","\n","                    ","}","\n","\n","                    ","function setMembership(address addr, bool ok) public onlyOwner ","{","\n","                        ","isMember[addr] = ok;","\n","                    ","}","\n","\n","                    ","function getHash(TxInfo calldata t) internal pure returns (bytes32) ","{","\n","                        ","bytes32 h = keccak256(abi.encodePacked(t.chainId, t.timestamp, t.txid, t.fromAccount, t.toAccount, t.value, t.callData));","\n","                        ","return keccak256(abi.encodePacked(PREFIX, h));","\n","                    ","}","\n","\n","                    ","function getHash(LogInfo calldata l) internal pure returns (bytes32) ","{","\n","                        ","bytes32 h = keccak256(abi.encodePacked(l.chainId, l.timestamp, l.sourceContract, l.topics, l.data));","\n","                        ","return keccak256(abi.encodePacked(PREFIX, h));","\n","                    ","}","\n","\n","                    ","function isQualified(address authorizer, TxInfo calldata txInfo, Signature calldata txSig,","\n","                                ","LogInfo calldata logInfo, Signature calldata logSig) public view returns (bool) ","{","\n","                        ","if(isMember[msg.sender]) return true;","\n","                        ",'require(authorizer==ecrecover(getHash(txInfo), txSig.v, txSig.r, txSig.s), "invalid-txSig");',"\n","                        ",'require(authorizer==ecrecover(getHash(logInfo), logSig.v, logSig.r, logSig.s), "invalid-logSig");',"\n","                        ","uint twoMonthAgo = block.timestamp - 60 days;","\n","                        ","return txInfo.toAccount==calledContract && txInfo.fromAccount == msg.sender &&","\n","                            ","logInfo.topics[0]==TransferEvent && logInfo.topics[2]==bytes32(bytes20(msg.sender)) &&","\n","                            ","twoMonthAgo < txInfo.timestamp && twoMonthAgo < logInfo.timestamp;","\n","                    ","}","\n","                ","}","\n","                "]})})}),(0,x.jsxs)("p",{children:["Before calling ",(0,x.jsx)("cite",{children:"isQualifed"}),", a requestor must query the authorizer to get ",(0,x.jsx)("cite",{children:"TxInfo"})," and ",(0,x.jsx)("cite",{children:"LogInfo"}),", which will be used as the arguments to call ",(0,x.jsx)("cite",{children:"isQualified"}),". The first argument must be the authorizer\u2019s address, which is used to ensure the ",(0,x.jsx)("cite",{children:"TxInfo"})," and ",(0,x.jsx)("cite",{children:"LogInfo"})," were really generated by the same authorizer."]}),(0,x.jsxs)("p",{children:["When the authorizer endorses the ",(0,x.jsx)("cite",{children:"EthCallInfo"})," struct after calling ",(0,x.jsx)("cite",{children:"isQualified"}),", the requestor has a proof that he is a qualified account."]}),(0,x.jsx)("p",{children:"Now, we want to upgrade this file-sharing service to support encryption and decryption. The files are decrypted with symmetric keys which is only known to the qualified accounts. Any qualified account can use the symmetric key of current time to encrypt and upload files. But different accounts have different permissions in decryption:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Someone who is explicitly marked as qualified member by a superuser, can decrypt all the files."}),(0,x.jsx)("li",{children:"Someone who has called a contract and received a given ERC20 token in the recent two months, can only decrypt the files which are encrypted in recent five days."})]}),(0,x.jsxs)("p",{children:["We add a new function ",(0,x.jsx)("cite",{children:"getSecret"})," to the ",(0,x.jsx)("cite",{children:"Membership"})," contract:"]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"function setForbidden(uint fileid, bool foridden) public onlyOwner ","{","\n","                    ","forbiddenFiles[fileid] = foridden;","\n","                ","}","\n","\n","                ","function getSecret(address authorizer, uint fileid, TxInfo calldata txInfo, Signature calldata txSig,","\n","                        ","LogInfo calldata logInfo, Signature calldata logSig, uint shareTime) public view returns (uint, uint) ","{","\n","                    ","if(forbiddenFiles[fileid]) return (0, 0);","\n","                    ","if(isMember[msg.sender]) return (shareTime, fileid);","\n","                    ",'require(authorizer==ecrecover(getHash(txInfo), txSig.v, txSig.r, txSig.s), "invalid-txSig");',"\n","                    ",'require(authorizer==ecrecover(getHash(logInfo), logSig.v, logSig.r, logSig.s), "invalid-logSig");',"\n","                    ","uint twoMonthAgo = block.timestamp - 60 days;","\n","                    ","bool qualified = txInfo.toAccount==calledContract && txInfo.fromAccount == msg.sender &&","\n","                        ","logInfo.topics[0]==TransferEvent && logInfo.topics[2]==bytes32(bytes20(msg.sender)) &&","\n","                        ","twoMonthAgo < txInfo.timestamp && twoMonthAgo < logInfo.timestamp;","\n","                    ","if(qualified && block.timestamp - 5 days < shareTime && shareTime < block.timestamp + 1 hours) ","{","\n","                        ","return (shareTime, fileid);","\n","                    ","}","\n","                    ","return (0, 0);","\n","                ","}","\n","                "]})})}),(0,x.jsxs)("p",{children:["The argument ",(0,x.jsx)("cite",{children:"shareTime"})," is the  time when this file was encrypted and shared. The ",(0,x.jsx)("cite",{children:"fileid"})," is a unque id assigned to each shared file. The superuse can disable the sharing of individual files by calling ",(0,x.jsx)("cite",{children:"setForbidden"})," using ",(0,x.jsx)("cite",{children:"fileid"}),". If several files belong to a single file logically, such as the segments of the same m3u8 file, or the files of a multi-part archive, it is suggested that they share the same ",(0,x.jsx)("cite",{children:"fileid"}),"."]}),(0,x.jsxs)("p",{children:["A requestor asks the authorizer to call ",(0,x.jsx)("cite",{children:"getSecret"})," function for secret-granting. The authorizer will fill a ",(0,x.jsx)("cite",{children:"SecretSeed"})," struct and use it to generate a VRF output. This output is used as the symmetric key for encryption and decryption."]})]}),(0,x.jsxs)("div",{className:"section",id:"the-rpc-endpoints",children:[(0,x.jsxs)("h5",{children:["The RPC Endpoints",(0,x.jsx)("a",{className:"headerlink",href:"#the-rpc-endpoints",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"An authorizer provides four RPC endpoints to support the mentioned primitives. All these endpoints returns a JSON object, with the following fields:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"IsSuccess: If the RPC finishes successfully"}),(0,x.jsx)("li",{children:"Message: When IsSuccess equals true, it\u2019s an empty string. When IsSuccess equals false, it\u2019s the string explaining the reason"}),(0,x.jsx)("li",{children:"Result: for granting secret, this is the from-account\u2019s address and the VRF output (in recryptor mode this output is encrypted); for the other endpoints, this is the raw bytes to be signed."}),(0,x.jsx)("li",{children:"Proof: for granting secret, this is the VRF proof; for the other endpoints, this is the signature"}),(0,x.jsx)("li",{children:"Salt:  Only used in the recryptor mode for granting secret. It\u2019s first eight bytes is the current timestamp (little endian) and the other bytes are random number generated by hardware RNG."}),(0,x.jsx)("li",{children:"PubKey: Only used in the recryptor mode for granting secret. It\u2019s the authorizer\u2019s public key."})]}),(0,x.jsx)("p",{children:"In recryptor mode, the recryptor calculates a secret with its private key and the authorizer\u2019s PubKey, and then uses this secret and the returned Salt to decrypt the returned Result to get VRF output."})]})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-historical-contract-interaction-1",children:[(0,x.jsxs)("h2",{children:["Endorse historical contract interaction",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-historical-contract-interaction-1",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_tx?hash",(0,x.jsx)("span",{className:"o",children:"="}),"<transaction-hash-id>","\n","                "]})})}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"hash"})," parameter is hex format and starts with \u201c0x\u201d."]})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-historical-events-1",children:[(0,x.jsxs)("h2",{children:["Endorse historical events",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-historical-events-1",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_log?contract",(0,x.jsx)("span",{className:"o",children:"="}),"<contract-address>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"block"}),(0,x.jsx)("span",{className:"o",children:"="}),"<blockhash>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"topic0"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"topic1"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"topic2"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"topic3"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string>","\n","                "]})})}),(0,x.jsxs)("p",{children:["The parameters ",(0,x.jsx)("cite",{children:"topic0`~`topic3"})," are used to filter out one single EVM log generated by the ",(0,x.jsx)("cite",{children:"contract"})," in the specified ",(0,x.jsx)("cite",{children:"block"}),". Some or all of them can be omitted, as long as exactly one EVM-log is got after filtering."]}),(0,x.jsx)("p",{children:"All these parameters are hex format and start with \u201c0x\u201d."})]}),(0,x.jsxs)("div",{className:"section",id:"endorse-the-outputs-of-eth-call-1",children:[(0,x.jsxs)("h2",{children:["Endorse the outputs of eth_call",(0,x.jsx)("a",{className:"headerlink",href:"#endorse-the-outputs-of-eth-call-1",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_call?contract",(0,x.jsx)("span",{className:"o",children:"="}),"<contract-address>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"data"}),(0,x.jsx)("span",{className:"o",children:"="}),"<calldata>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"from"}),(0,x.jsx)("span",{className:"o",children:"="}),"<from-account-address>","\n","                "]})})}),(0,x.jsx)("p",{children:"All these three parameters are hex format and start with \u201c0x\u201d."})]}),(0,x.jsxs)("div",{className:"section",id:"granting-secrets-to-account-owners-1",children:[(0,x.jsxs)("h2",{children:["Granting secrets to account owners",(0,x.jsx)("a",{className:"headerlink",href:"#granting-secrets-to-account-owners-1",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_grantcode?time",(0,x.jsx)("span",{className:"o",children:"="}),"<unix-timestamp>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"contract"}),(0,x.jsx)("span",{className:"o",children:"="}),"<contract-address>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"datalist"}),(0,x.jsx)("span",{className:"o",children:"="}),"<calldatalist>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"nth"}),(0,x.jsx)("span",{className:"o",children:"="}),"<index-of-calldata>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"sig"}),(0,x.jsx)("span",{className:"o",children:"="}),"<from-account-signature>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"recryptorpk"}),(0,x.jsx)("span",{className:"o",children:"="}),"<pubkey-of-recyrptor>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"out"}),(0,x.jsx)("span",{className:"o",children:"="}),"<outdata>","\n","                "]})})}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"time"})," parameter is a decimal integer. All the other five parameters are hex format and start with \u201c0x\u201d."]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"recryptorpk"})," and ",(0,x.jsx)("cite",{children:"out"})," parameters are only used in recryptor mode, where the requestor is the recryptor enclave. The ",(0,x.jsx)("cite",{children:"recryptorpk"})," presents the public key of the recryptor and we are in recryptor mode if it is specified. In recryptor mode, the body of the http request must be the attestation report of the recryptor enclave. Authorizers check this report to ensure the request is sent from an SGX enclave."]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("cite",{children:"calldatalist"})," is a list of ",(0,x.jsx)("cite",{children:"calldata"})," for different authorizers to query ",(0,x.jsx)("cite",{children:"eth_call"}),". ",(0,x.jsx)("cite",{children:"nth"})," specifies which entry in ",(0,x.jsx)("cite",{children:"calldatalist"})," is the ",(0,x.jsx)("cite",{children:"calldata"})," for this authorizer. Each entry of ",(0,x.jsx)("cite",{children:"calldatalist"})," is a hex string and commas are used to separate the entries."]}),(0,x.jsxs)("p",{children:["The 20 bytes of ",(0,x.jsx)("cite",{children:"calldata[16:36]"})," will be overwritten by the authorizer\u2019s EVM address, before the authorizer uses ",(0,x.jsx)("cite",{children:"calldata"})," to query ",(0,x.jsx)("cite",{children:"eth_call"}),". Thus, the called function can read this EVM address as its first argument."]}),(0,x.jsxs)("p",{children:["The from-account\u2019s address can be recovered from the ",(0,x.jsx)("cite",{children:"sig"})," parameter. When the ",(0,x.jsx)("cite",{children:"sig"})," is omitted, the ",(0,x.jsx)("cite",{children:"from"})," account has zero address. The ",(0,x.jsx)("cite",{children:"sig"})," is generated using MetaMask\u2019s ",(0,x.jsx)("cite",{children:"personal_sign"}),". The signed text is:"]}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"To Authorizer: ",(0,x.jsx)("span",{className:"nv",children:"time"}),(0,x.jsx)("span",{className:"o",children:"="}),"<unix-timestamp>, ",(0,x.jsx)("span",{className:"nv",children:"contract"}),(0,x.jsx)("span",{className:"o",children:"="}),"<contract-evm-address>, ",(0,x.jsx)("span",{className:"nv",children:"data"}),(0,x.jsx)("span",{className:"o",children:"="}),"<keccak256-of-datalist-with-0x-prefix>","\n","                "]})})}),(0,x.jsxs)("p",{children:["In recryptor mode, if the recryptor wants to push a file to cloud, it uses the ",(0,x.jsx)("cite",{children:"out"})," parameter to specifiy the output of ",(0,x.jsx)("cite",{children:"eth_call"}),". Then the authorization will not query ",(0,x.jsx)("cite",{children:"eth_call"}),". Instead, it uses the ",(0,x.jsx)("cite",{children:"out"})," parameter as the output of ",(0,x.jsx)("cite",{children:"eth_call"}),"."]}),(0,x.jsxs)("div",{className:"section",id:"load-balance-and-authentication",children:[(0,x.jsxs)("h5",{children:["Load Balance and Authentication",(0,x.jsx)("a",{className:"headerlink",href:"#load-balance-and-authentication",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The enclave implementation of Elfin authorizer is designed to run on a single machine. The service provider can run many Elfin authorizer enclaves and use a reverse proxy to distribute the requests to them."}),(0,x.jsx)("p",{children:"The provider can only provide services to a limited set of customers, such as the recryptors of a CDN vendor who has paid. The RPC endpoints provided by the enclave do not support authentication."}),(0,x.jsx)("p",{children:"If the provider would like to use some authentication methods (basic auth, API keys, etc), it can use the reverse proxy to deploy them. The basic auth header and the API key parameter must be removed before forwarding the request to the enclaves."})]}),(0,x.jsxs)("div",{className:"section",id:"rate-limit",children:[(0,x.jsxs)("h5",{children:["Rate Limit",(0,x.jsx)("a",{className:"headerlink",href:"#rate-limit",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The Elfin authorizer does not support rate limit. The service provider can implement rate limit in the reverse proxy."})]})]})]})]}),2===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"Elfin Recryptor"}),(0,x.jsxs)("div",{className:"section",style:{flexShrink:"unset"},id:"elfin-recryptor",children:[(0,x.jsxs)("h1",{children:["Elfin Recryptor",(0,x.jsx)("a",{className:"headerlink",href:"#elfin-recryptor",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"section",id:"a-new-function-in-content-delivery",children:[(0,x.jsxs)("h2",{children:["A new function in content delivery",(0,x.jsx)("a",{className:"headerlink",href:"#a-new-function-in-content-delivery",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"CDN providers run recryptors to serve the authors and audience."}),(0,x.jsx)("p",{children:"The authors and audience connect to recryptor enclaves through https links directly. Even the CDN providers do not know what are transferred through the TLS tunnel."}),(0,x.jsxs)("p",{children:["The recryptor acts as a ",(0,x.jsx)("a",{className:"reference external",href:"https://grpc.io",children:"gRPC"})," client to get IPFS data from a RPCX server run by the same CDN provider."]}),(0,x.jsx)("div",{className:"section",id:"serve-the-author",children:(0,x.jsxs)("h5",{children:["Serve the author",(0,x.jsx)("a",{className:"headerlink",href:"#serve-the-author",title:"Permalink to this headline"})]})})]}),(0,x.jsxs)("div",{className:"section",id:"start-an-encryption-task",children:[(0,x.jsxs)("h2",{children:["Start an encryption task",(0,x.jsx)("a",{className:"headerlink",href:"#start-an-encryption-task",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"A GET request should be sent to such a URL:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getEncryptTaskToken?fileId",(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"sig"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-encoded-signature>","\n"]})})}),(0,x.jsx)("p",{children:"It returns a json string with three fields:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"encrypt_task_token, an encryption task token (base58-encoded)"}),(0,x.jsx)("li",{children:"recryptorsalt: a recryptorsalt (base64-encoded)"}),(0,x.jsx)("li",{children:"pubkey: the recryptor\u2019s pubkey (base64-encoded)"})]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"fileId"})," is a unique id the author assigned to his files. It can be sha256sum or IPFS CID, or anything the author likes."]}),(0,x.jsxs)("p",{children:["The author endorses the ",(0,x.jsx)("cite",{children:"fileId"})," with a signature ",(0,x.jsx)("cite",{children:"sig"}),", which is generated using MetaMask\u2019s ",(0,x.jsx)("cite",{children:"personal_sign"}),". The signed text is:"]}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"To Recryptor: ",(0,x.jsx)("span",{className:"nv",children:"fileId"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-string-with-0x-prefix>","\n"]})})}),(0,x.jsx)("p",{children:"The recryptor salt is a true random number generated by the recryptor enclave. It will be used in decryption."})]}),(0,x.jsxs)("div",{className:"section",id:"get-encrypted-parts-from-authorizers",children:[(0,x.jsxs)("h2",{children:["Get encrypted parts from authorizers",(0,x.jsx)("a",{className:"headerlink",href:"#get-encrypted-parts-from-authorizers",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"A POST request should be sent to such a URL:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getEncryptedParts?token",(0,x.jsx)("span",{className:"o",children:"="}),"<base58-string>","\n"]})})}),(0,x.jsxs)("p",{children:["The encryption task token is given as the ",(0,x.jsx)("cite",{children:"token"})," parameter. The body of the request is a json string with following schema:"]}),(0,x.jsx)("div",{className:"highlight-json notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"p",children:"{"}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"$schema"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"http://json-schema.org/draft-04/schema#"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"title"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"ElfinGuard Encryption Guide"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"Instructions Used by Recryptors to Decrypt Files"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"object"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"properties"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"chainid"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a hex string indicating the target chain\'s ID"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"contract"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the EVM address of the authorization contract"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"function"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the signature of the function to be called"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"threshold"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the minimum number of authorizers required to decrypt this file"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"exclusiveMinimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"false"}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"authorizerlist"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the domain name of an authorizer"'}),"\n","             ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"outdata"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the expected outdata from eth_call"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","    ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n",(0,x.jsx)("span",{className:"p",children:"}"}),"\n"]})})}),(0,x.jsx)("p",{children:"It returns json-encoded byte string list. Each entry of the list is an encrypted parts from an authorizer."})]}),(0,x.jsxs)("div",{className:"section",id:"encrypt-file-chunks",children:[(0,x.jsxs)("h2",{children:["Encrypt file chunks",(0,x.jsx)("a",{className:"headerlink",href:"#encrypt-file-chunks",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"A POST request should be sent to follow URLs:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_encryptChunk?token",(0,x.jsx)("span",{className:"o",children:"="}),"<base58-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"index"}),(0,x.jsx)("span",{className:"o",children:"="}),"<chunk-index>","\n","/eg_encryptChunkOnServer?token",(0,x.jsx)("span",{className:"o",children:"="}),"<base58-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"index"}),(0,x.jsx)("span",{className:"o",children:"="}),"<chunk-index>","\n"]})})}),(0,x.jsx)("p",{children:"A file is looked as a list of 256KB chunks.  It must be encrypted chunk by chunk."}),(0,x.jsxs)("p",{children:["The body of the request is the bytes of a chunk. The encryption task token is given as the ",(0,x.jsx)("cite",{children:"token"})," parameter, and ",(0,x.jsx)("cite",{children:"index"})," shows the index of this chunk in the file\u2019s chunk list."]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"encryptChunk"})," RPC returns the encrypted chunk. The ",(0,x.jsx)("cite",{children:"encryptChunkOnServer"})," RPC writes the encrypted chunk to the server\u2019s local file at a proper offset indicated by the ",(0,x.jsx)("cite",{children:"index"})," parameter."]}),(0,x.jsxs)("p",{children:["Using repeatly requests, you can fill the fully-encrypted file at the client side (",(0,x.jsx)("cite",{children:"encryptChunk"}),") or at the server side (",(0,x.jsx)("cite",{children:"encryptChunkOnServer"}),")."]}),(0,x.jsx)("div",{className:"section",id:"serve-the-audience",children:(0,x.jsxs)("h5",{children:["Serve the audience",(0,x.jsx)("a",{className:"headerlink",href:"#serve-the-audience",title:"Permalink to this headline"})]})})]}),(0,x.jsxs)("div",{className:"section",id:"start-a-decryption-task",children:[(0,x.jsxs)("h2",{children:["Start a decryption task",(0,x.jsx)("a",{className:"headerlink",href:"#start-a-decryption-task",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getDecryptTaskToken","\n"]})})}),(0,x.jsx)("p",{children:"The body of the request is a json string with the follow schema:"}),(0,x.jsx)("div",{className:"highlight-json notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"p",children:"{"}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"$schema"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"http://json-schema.org/draft-04/schema#"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"title"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"ElfinGuard Decryption Guide"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"Instructions Used by Recryptors to Decrypt Files"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"object"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"properties"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"chainid"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a hex string indicating the target chain\'s ID"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"contract"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the EVM address of the authorization contract"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"function"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the signature of the function to be called"'}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"threshold"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the minimum number of authorizers required to decrypt this file"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"exclusiveMinimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"false"}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"authorizerlist"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the domain name of an authorizer"'}),"\n","             ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"outdata"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the expected outdata from eth_call"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","         ",(0,x.jsx)("span",{className:"s2",children:'"encryptedparts"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"base64-encoded shamir part encrypted with the grantcode from the authorizer"'}),"\n","             ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","         ",(0,x.jsx)("span",{className:"s2",children:'"calldatalist"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the calldata sent to the authorizer as the calldata to call the contract address. calldata[36:68] must equal the fileid"'}),"\n","             ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","         ",(0,x.jsx)("span",{className:"s2",children:'"signature"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a signature signed by the requestor"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"timestamp"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the UNIX timestamp when the requestor signs the signature"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"recryptorsalt"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"random bytes generated by the recryptor"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","         ",(0,x.jsx)("span",{className:"nt",children:'"fileid"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","             ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","             ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a unique id for this file"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","     ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n",(0,x.jsx)("span",{className:"p",children:"}"}),"\n"]})})}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"fileid"})," parameter was specified by the author and was used in calling the ",(0,x.jsx)("cite",{children:"getEncryptTaskToken"})," endpoint. The ",(0,x.jsx)("cite",{children:"recryptorsalt"})," parameter was got by calling the ",(0,x.jsx)("cite",{children:"getEncryptTaskToken"})," endpoint."]}),(0,x.jsxs)("p",{children:["The requestor must properly construct the ",(0,x.jsx)("cite",{children:"signature"})," and ",(0,x.jsx)("cite",{children:"calldatalist"})," to prove he is qualified to view the file."]}),(0,x.jsx)("p",{children:"This endpiont returns a json string with following fields:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"decrypt_task_token: a decryption task token (base58-encoded)"}),(0,x.jsx)("li",{children:"pubkey: the recryptor\u2019s pubkey (base64-encoded)"})]})]}),(0,x.jsxs)("div",{className:"section",id:"get-the-decrypted-file",children:[(0,x.jsxs)("h2",{children:["Get the decrypted file",(0,x.jsx)("a",{className:"headerlink",href:"#get-the-decrypted-file",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The RPC endpiont\u2019s URL is like below:"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_decryptChunk?token",(0,x.jsx)("span",{className:"o",children:"="}),"<base58-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"index"}),(0,x.jsx)("span",{className:"o",children:"="}),"<unique-integer>","\n","/eg_getDecryptedFile?token",(0,x.jsx)("span",{className:"o",children:"="}),"<base58-string>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"path"}),(0,x.jsx)("span",{className:"o",children:"="}),"<file-path-on-ipfs>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"size"}),(0,x.jsx)("span",{className:"o",children:"="}),"<integer>","\n"]})})}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"decryptChunk"})," endpoint decrypts the byte string given in the POST body and returns the decrypted plaintext. The ",(0,x.jsx)("cite",{children:"getDecryptedFile"})," endpoint decrypts a file on decentralized storage, and it supports resuming breakpoints during downloading, using the ",(0,x.jsx)("cite",{children:"Content-Range"})," Header."]}),(0,x.jsxs)("p",{children:["A client-side file can be encrypted by ",(0,x.jsx)("cite",{children:"encryptChunk"})," and then decrypted by ",(0,x.jsx)("cite",{children:"decryptChunk"}),". The ",(0,x.jsx)("cite",{children:"index"})," parameter used by ",(0,x.jsx)("cite",{children:"decryptChunk"})," must be the same as the one used when calling ",(0,x.jsx)("cite",{children:"encryptChunk"}),". The ",(0,x.jsx)("cite",{children:"encryptChunk"}),"/",(0,x.jsx)("cite",{children:"decryptChunk"})," endpoints are sued in some use cases where files are shared through some traditional methods, such as email and ftp, instead of decentralized storages."]}),(0,x.jsxs)("p",{children:["The decryption task token is given as the ",(0,x.jsx)("cite",{children:"token"})," parameter. The ",(0,x.jsx)("cite",{children:"path"})," pamameter specifies a file on IPFS from the RPCX/gRPC server. The ",(0,x.jsx)("cite",{children:"size"})," parameter specifies the size of the returned data. If the decrypted data is larger than it, then the tail is truncated and not returned."]}),(0,x.jsxs)("div",{className:"section",id:"load-balance-and-authentication",children:[(0,x.jsxs)("h5",{children:["Load Balance and Authentication",(0,x.jsx)("a",{className:"headerlink",href:"#load-balance-and-authentication",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"Recryptors are decentralized in a geographic way, because CDN vendors run recryptors on edge nodes. The requestor query a CDN vendor for the nearest recryptor node. Or, the requestor send request to the CDN vendor, which will redirect the request to a nearest recryptor node."}),(0,x.jsx)("p",{children:"Clients must connect directly to an enclave without any HTTP proxy, to ensure the TLS channel can prevent third parties (including the CDN vendor) from stealing the original file."}),(0,x.jsx)("p",{children:"Recryptors do not support normal ways for authentication (basic auth, API keys, etc). Instead, to start an encryption task or a decryption task, the requestor must sign a signature to prove her identity."}),(0,x.jsx)("p",{children:"A decryption/encryption task token can only be read by the same enclave that wrote it. So a requestor must stick to the same enclave during the same decryption/encryption task."})]}),(0,x.jsxs)("div",{className:"section",id:"proxy-to-authorizers",children:[(0,x.jsxs)("h5",{children:["Proxy to authorizers",(0,x.jsx)("a",{className:"headerlink",href:"#proxy-to-authorizers",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"CDN vendors\u2019s recryptors have a high volume of requests sending to the authorizers. Usually, CDN vendors would like to pay the authorizers for better service. And the authorizers will provide dedicated servers (with special domain name) or dedicated API keys to the paid customers."}),(0,x.jsx)("p",{children:"Recryptors do not know the dedicated servers or API keys. CDN vendor must run a HTTP proxy which forward the recyrptors\u2019 requests to authorizers."})]}),(0,x.jsxs)("div",{className:"section",id:"rate-limit",children:[(0,x.jsxs)("h5",{children:["Rate Limit",(0,x.jsx)("a",{className:"headerlink",href:"#rate-limit",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"The recryptor does not support rate limit itself. Instead, it can connect to an external rate limiter run by the CDN vendor as a microservice."})]}),(0,x.jsxs)("div",{className:"section",id:"recryptor-coordinator",children:[(0,x.jsxs)("h5",{children:["Recryptor Coordinator",(0,x.jsx)("a",{className:"headerlink",href:"#recryptor-coordinator",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"A CDN provider runs a coordinator which coordinates all its recryptors and the backend storage engine. A coordinator has the following functions:"})]})]}),(0,x.jsxs)("div",{className:"section",id:"wallet-based-login",children:[(0,x.jsxs)("h2",{children:["Wallet-based login",(0,x.jsx)("a",{className:"headerlink",href:"#wallet-based-login",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"You can login to the coordinator and get a session id."}),(0,x.jsx)("p",{children:"First, you get a random hex string through the following RPC endpoint."}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getNonce","\n"]})})}),(0,x.jsxs)("p",{children:["Then, you sign this hex string using ",(0,x.jsx)("cite",{children:"personal_sign"})," and use the signature to call the following RPC endpoint:"]}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getSessionID?sig",(0,x.jsx)("span",{className:"o",children:"="}),"<hex-encoded-signature>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"nonce"}),(0,x.jsx)("span",{className:"o",children:"="}),"<hex-encoded-nonce>","\n"]})})}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"nonce"})," parameter used to call ",(0,x.jsx)("cite",{children:"eg_getSessionID"})," must the returned value of ",(0,x.jsx)("cite",{children:"eg_getNonce"}),"."]}),(0,x.jsx)("p",{children:"A session ID is returned to you, which can be used in later requests."})]}),(0,x.jsxs)("div",{className:"section",id:"assign-a-nearby-recryptor",children:[(0,x.jsxs)("h2",{children:["Assign a nearby recryptor",(0,x.jsx)("a",{className:"headerlink",href:"#assign-a-nearby-recryptor",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"You can ask the coordinator to assign a nearby recryptor to you, for an encryption or decryption task."}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getRecryptor?session",(0,x.jsx)("span",{className:"o",children:"="}),"<session-id>","\n"]})})}),(0,x.jsx)("p",{children:"The domain name of the assigned recryptor will be returned."})]}),(0,x.jsxs)("div",{className:"section",id:"gateway-to-decentralized-storages",children:[(0,x.jsxs)("h2",{children:["Gateway to decentralized storages",(0,x.jsx)("a",{className:"headerlink",href:"#gateway-to-decentralized-storages",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"You can get a non-encrypted file from decentralized storage (such as IPFS):"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getFile?path",(0,x.jsx)("span",{className:"o",children:"="}),"<path-of-the-file>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"session"}),(0,x.jsx)("span",{className:"o",children:"="}),"<session-id>","\n"]})})}),(0,x.jsxs)("p",{children:["The format of ",(0,x.jsx)("cite",{children:"path"})," depends on the decentralized storage solution. For IPFS, the path is a CID followed by the file\u2019s path in the Elfin directory."]}),(0,x.jsx)("p",{children:"This RPC helps you get the readme.txt file and the config.json file in the Elfin directory. It may limit the size of the returned file and/or download speed."})]}),(0,x.jsxs)("div",{className:"section",id:"upload-an-immutable-directory",children:[(0,x.jsxs)("h2",{children:["Upload an immutable directory",(0,x.jsx)("a",{className:"headerlink",href:"#upload-an-immutable-directory",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["You can request the coordinator to upload an immutable directory onto IPFS by posting a ",(0,x.jsx)("a",{className:"reference external",href:"https://developer.mozilla.org/en-US/docs/Web/API/FormData",children:"FormData"})," (multipart/form-data)."]}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_upload?session",(0,x.jsx)("span",{className:"o",children:"="}),"<session-id>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"recryptor"}),(0,x.jsx)("span",{className:"o",children:"="}),"<domain-name-of-recryptor>","\n"]})})}),(0,x.jsxs)("p",{children:["The format of the FormData is introduced in the ",(0,x.jsx)("span",{className:"xref std std-ref",children:"elfindirectory:FormData for upload"})," section."]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("cite",{children:"recryptor"})," parameter gives the domain name of the recryptor who run ",(0,x.jsx)("cite",{children:"encryptChunk"})," for the encrypted files in the immutable directory."]}),(0,x.jsx)("p",{children:"This RPC endpoint will return the CID of the immutable directory."})]}),(0,x.jsxs)("div",{className:"section",id:"proxy-to-elfin-authorizers",children:[(0,x.jsxs)("h2",{children:["Proxy to Elfin Authorizers",(0,x.jsx)("a",{className:"headerlink",href:"#proxy-to-elfin-authorizers",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"You can request the coordinator to assign a proxy to you, which can forward your request to an Elfin authorizer."}),(0,x.jsx)("p",{children:"Note that it needs to input chain name"}),(0,x.jsx)("div",{className:"highlight-bash notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),"/eg_getProxy?session",(0,x.jsx)("span",{className:"o",children:"="}),"<session-id>",(0,x.jsx)("span",{className:"p",children:"&"}),(0,x.jsx)("span",{className:"nv",children:"chain_name"}),(0,x.jsx)("span",{className:"o",children:"="}),"<chain-name>","\n"]})})}),(0,x.jsxs)("p",{children:["Usually, end users pay CDN providers for higher download speed. However, end users do not directly pay authorizers. Instead, CDN providers will pay the authorizers. To better serve its customers, a CDN provider can build a proxy to forward customers\u2019 requests (",(0,x.jsx)("cite",{children:"/tx"}),", ",(0,x.jsx)("cite",{children:"/log"})," and ",(0,x.jsx)("cite",{children:"/calldata"}),") to Elfin authorizers."]})]})]})]}),3===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"Elfin Directory"}),(0,x.jsx)("div",{className:"section",id:"elfin-directory",children:(0,x.jsxs)("div",{children:[(0,x.jsxs)("h1",{children:["Elfin Directory",(0,x.jsx)("a",{className:"headerlink",href:"#elfin-directory",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"section",id:"arrange-permissioned-contents-on-decentralized-storages",children:[(0,x.jsxs)("h2",{children:["Arrange Permissioned Contents on Decentralized Storages",(0,x.jsx)("a",{className:"headerlink",href:"#arrange-permissioned-contents-on-decentralized-storages",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"admonition note",children:[(0,x.jsxs)("p",{className:"flex items-center first admonition-title",children:[(0,x.jsx)(o.Z,{className:" ".concat(h.styleError)}),"Note"]}),(0,x.jsx)("p",{className:"last",children:"Currently this document only specifies immutable directory on IPFS. Specifications for other decentralized storages will come soon."})]}),(0,x.jsxs)("p",{children:["IPFS supports ",(0,x.jsx)("a",{className:"reference external",href:"https://docs.ipfs.tech/concepts/file-systems",children:"Immutable Filesystem"}),", and a IPFS URL can actually ",(0,x.jsx)("a",{className:"reference external",href:"https://discuss.ipfs.tech/t/understanding-ipfs-directories/2219",children:"point to a directory"}),"."]}),(0,x.jsx)("p",{children:"Sometimes we want to share several files as a whole through. For example:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"HLS playlist (.m3u8) file and the segment files"}),(0,x.jsx)("li",{children:"A html file and its resources (images, videos, css, js)"}),(0,x.jsx)("li",{children:"A markdown (.md) file and its images"}),(0,x.jsx)("li",{children:"A video file and several subtitle files for it"})]}),(0,x.jsx)("p",{children:"As a convention, in the IPFS immutable directory:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"The entry file must be named as \u201cindex\u201d, such as index.m3u8, index.html, index.md"}),(0,x.jsxs)("li",{children:["There can be a \u201creadme.md\u201d file to briefly introduce the files in this directory. It can have only text contents or include ",(0,x.jsx)("a",{className:"reference external",href:"https://github.com/home-assistant/frontend/issues/5576",children:"base64-encoded images"}),"."]}),(0,x.jsx)("li",{children:"There must be a \u201cconfig.json\u201d file to guide viewers in decrypting some of the files in this directory. It is allowed that some of the files are not encrypted."})]})]}),(0,x.jsxs)("div",{className:"section",id:"metadata-s-schema",children:[(0,x.jsxs)("h2",{children:["Metadata\u2019s schema",(0,x.jsx)("a",{className:"headerlink",href:"#metadata-s-schema",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["The ",(0,x.jsx)("a",{className:"reference external",href:"http://json-schema.org/learn/getting-started-step-by-step",children:"schema"})," of the \u201cconfig.json\u201d file is as follows:"]}),(0,x.jsx)("div",{className:"highlight-json notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"p",children:"{"}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"$schema"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"http://json-schema.org/draft-04/schema#"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"title"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"ElfinGuard Recryptor Configuration"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"Configures the ElfinGuard Recryptor to Decrypt Files"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"object"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","    ",(0,x.jsx)("span",{className:"nt",children:'"properties"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","        ",(0,x.jsx)("span",{className:"nt",children:'"version"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"The Version of ElfinGuard Protocol"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","            ",(0,x.jsx)("span",{className:"s2",children:'"minimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"0"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"exclusiveMinimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"false"}),"\n","        ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","        ",(0,x.jsx)("span",{className:"nt",children:'"introduction"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","            ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"briefly introduce the contents in this directory"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","        ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","        ",(0,x.jsx)("span",{className:"nt",children:'"keywords"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","            ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"some keywords which help search engines indexing this elfin directory, seperated by commas"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","        ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","        ",(0,x.jsx)("span",{className:"nt",children:'"author"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"name"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"The author\'s name"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"homepage"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"The home page of the author (https or ipns)"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"evm_address"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"The author\'s EVM address"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","        ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","        ",(0,x.jsx)("span",{className:"nt",children:'"files"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"provide information for decrypting some of the files in the directory"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","            ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"object"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                 ",(0,x.jsx)("span",{className:"nt",children:'"properties"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                     ",(0,x.jsx)("span",{className:"nt",children:'"filename"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                         ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the name of a file in this directory"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                     ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                     ",(0,x.jsx)("span",{className:"nt",children:'"fileid"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                         ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a unique id for this file"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                     ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                     ",(0,x.jsx)("span",{className:"nt",children:'"size"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","                         ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the size of the original file before encryption"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                     ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                     ",(0,x.jsx)("span",{className:"nt",children:'"recryptorsalt"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                         ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"random bytes generated by the recryptor"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                     ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                     ",(0,x.jsx)("span",{className:"nt",children:'"decryptionguides"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"Each blockchain has a dedicated decryption guide"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                         ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                              ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"object"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                              ",(0,x.jsx)("span",{className:"nt",children:'"properties"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"chainid"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"a hex string indicating the target chain\'s ID"'}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"contract"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the EVM address of the authorization contract"'}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"function"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the signature of the function to be called"'}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"threshold"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"integer"'}),"\n","                                      ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the minimum number of authorizers required to decrypt this file"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"minimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"exclusiveMinimum"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"false"}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"authorizerlist"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                          ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                          ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the domain name of an authorizer"'}),"\n","                                      ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"outdata"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),"\n","                                      ",(0,x.jsx)("span",{className:"s2",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"the expected outdata from eth_call"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                  ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                  ",(0,x.jsx)("span",{className:"nt",children:'"encryptedparts"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"array"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"items"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"p",children:"{"}),"\n","                                          ",(0,x.jsx)("span",{className:"nt",children:'"type"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"string"'}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                          ",(0,x.jsx)("span",{className:"nt",children:'"description"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"s2",children:'"base64-encoded shamir part encrypted with the grantcode from the authorizer"'}),"\n","                                      ",(0,x.jsxs)("span",{className:"p",children:["}",","]}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"minItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"mi",children:"1"}),(0,x.jsx)("span",{className:"p",children:","}),"\n","                                      ",(0,x.jsx)("span",{className:"nt",children:'"uniqueItems"'}),(0,x.jsx)("span",{className:"p",children:":"})," ",(0,x.jsx)("span",{className:"kc",children:"true"}),"\n","                                  ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","                              ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","                         ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","                     ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","                 ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","            ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","        ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n","    ",(0,x.jsx)("span",{className:"p",children:"}"}),"\n",(0,x.jsx)("span",{className:"p",children:"}"}),"\n"]})})})]}),(0,x.jsxs)("div",{className:"section",id:"formdata-for-upload",children:[(0,x.jsxs)("h2",{children:["FormData for upload",(0,x.jsx)("a",{className:"headerlink",href:"#formdata-for-upload",title:"Permalink to this headline"})]}),(0,x.jsxs)("p",{children:["To store a Elfin directory to IPFS, you must first submit the files that need encryption to the server side using the ",(0,x.jsx)("cite",{children:"encryptChunk"})," endpoint of the recryptor. After they are ready, you can upload the files in Elfin directory using ",(0,x.jsx)("a",{className:"reference external",href:"https://developer.mozilla.org/en-US/docs/Web/API/FormData",children:"FormData"})," (multipart/form-data). A FormData object should be created using the ",(0,x.jsx)("a",{className:"reference external",href:"https://developer.mozilla.org/en-US/docs/Web/API/FormData/append",children:"append"})," method, with the following arguments:"]}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"name: the full name of the file. A Elfin directory can contain subdirectories. So the full name may contain \u201c/\u201d."}),(0,x.jsx)("li",{children:"value: For a non-encrypted file, this is its Blob content. For an encrypted file, this is a hex string representing its recryptorsalt."})]})]})]})})]}),4===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"UTXO Adapter"}),(0,x.jsxs)("div",{className:"section",id:"utxo-adapter",children:[(0,x.jsxs)("h1",{children:["UTXO Adapter",(0,x.jsx)("a",{className:"headerlink",href:"#utxo-adapter",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"section",id:"utxo-chains-adaptor-to-elfinguard-authorizer",children:[(0,x.jsxs)("h2",{children:["UTXO Chains\u2019 Adaptor to ElfinGuard Authorizer",(0,x.jsx)("a",{className:"headerlink",href:"#utxo-chains-adaptor-to-elfinguard-authorizer",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"UTXO-based blockchains, such as Bitcoin, Bitcoin Cash, Litecoin, Dogecoin, do not have a logging scheme like EVM. UTXO adaptor derives an EVM transaction containing one EVM log from a UTXO-based transaction, such that ElfinGuard\u2019s authorizers can know what happened on these chains."}),(0,x.jsx)("p",{children:"The deriving rules are as follows:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"The first output must be an OP_RETURN output whose first data element is \u201cEGTX\u201d; otherwise, this transaction is NOT a derivable transaction."}),(0,x.jsx)("li",{children:"The second data element of OP_RETURN are mapped to the EVM Log\u2019s source contract address. If it is less than 20 bytes, it will be zero-padded. If it is longer than 20 bytes, it will be tail-truncated."}),(0,x.jsx)("li",{children:"The 3rd~6th non-emtpy data elements are mapped to LOG1/LOG2/LOG3/LOG4 instructions\u2019 topics, i.e., the solidity events\u2019 topics. Each one will be coverted to a big-endian bytes32 by zero-padding and tail-truncation. Empty data elements pushed by OP_FALSE are ignored and not mapped as topics."}),(0,x.jsxs)("li",{children:["The following data are concatenated together to form the LOG instructions\u2019 data.",(0,x.jsxs)("ol",{className:"arabic",children:[(0,x.jsx)("li",{children:"The confirmation count as a uint256. Yes, this number can be changed as time goes by. It is not a constant number. It will be -1 if the transaction cannot be found in mempool or the block history any more."}),(0,x.jsxs)("li",{children:["The P2PKH/P2SH outputs\u2019 recipient address (20 bytes) and value (12 bytes) as a uint256 array (",(0,x.jsx)("cite",{children:"uint256[]"}),"). The value is multiplied by ",(0,x.jsx)("cite",{children:"10**10"})," such that its unit is changed from satoshi to wei."]}),(0,x.jsxs)("li",{children:["The P2PKH/P2SH inputs\u2019 sender address (20 bytes) and value (12 bytes) as a uint256 array (",(0,x.jsx)("cite",{children:"uint256[]"}),"). The value is multiplied by ",(0,x.jsx)("cite",{children:"10**10"})," such that its unit is changed from satoshi to wei."]}),(0,x.jsxs)("li",{children:["The other data elements of OP_RETURN as a bytes array (",(0,x.jsx)("cite",{children:"bytes[]"}),")."]})]})]}),(0,x.jsx)("li",{children:"The first P2PKH/P2SH outputs\u2019 recipient address is taken as the to-address of the EVM transaction"}),(0,x.jsx)("li",{children:"The first P2PKH/P2SH inputs\u2019 sender address is taken as the from-address of the EVM transaction"})]}),(0,x.jsx)("p",{children:"Currently, we only implement an adaptor for Bitcoin Cash in this repo."}),(0,x.jsx)("p",{children:"We use virtual block number for these EVM logs. Different UTXO Adapter may generate different blocks for the same block number. The mempool is checked every 5 seconds and any new derivable transactions will be packed to a new virtual block. The mined blocks are also checked to find new derivable transactions."}),(0,x.jsx)("p",{children:"The name of these blockchains (Bitcoin, Bitcoin Cash, Litecoin, Dogecoin) are prefixed with \u201cvirtual\u201d and then mapped to bytes32 as their EVM chainId."}),(0,x.jsxs)("p",{children:["It is recommended that the source contract address (20 bytes) is calculated as ",(0,x.jsx)("cite",{children:"RIPEMD160(SHA256(URI))"}),". The URI is controlled by the authorizing contract\u2019s developers."]}),(0,x.jsx)("p",{children:"It is recommended that the derived logs are viewed as solidity\u2019s anonymous events, because always attaching the same 32 bytes to OP_RETURN is a waste."}),(0,x.jsx)("p",{children:"The virtual EVM blocks\u2019 attributes are left empty or zero except two:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Size: it is reused to store the time when this virtual block is build."}),(0,x.jsx)("li",{children:"GasUsed: it is reused to store the main chain\u2019s height scanned by this adaptor when this virtual block is build."})]}),(0,x.jsx)("p",{children:"These attributes depends on the local time of the adaptor\u2019s machine and the timing it sees the mempool\u2019s transactions. So they will differ from one adaptor to another adaptor."}),(0,x.jsx)("p",{children:"We don\u2019t want authorizers disagree on timestamp. So the local timestamp is store in \u2018Size\u2019 which is ignored by authorizers. And the blocks\u2019 timestamps are left as zero."})]})]})]}),5===t&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{id:"BCH Payment Judgers"}),(0,x.jsxs)("div",{className:"section",id:"bch-payment-judger",children:[(0,x.jsxs)("h1",{children:["BCH Payment Judger",(0,x.jsx)("a",{className:"headerlink",href:"#bch-payment-judger",title:"Permalink to this headline"})]}),(0,x.jsxs)("div",{className:"section",id:"an-online-judger-for-bch-stochastic-payments",children:[(0,x.jsxs)("h2",{children:["An online judger for BCH stochastic payments",(0,x.jsx)("a",{className:"headerlink",href:"#an-online-judger-for-bch-stochastic-payments",title:"Permalink to this headline"})]}),(0,x.jsx)("p",{children:"PaymentJudger is a third-party enclave to support stochastic payment on Bitcoin Cash mainchain. It serves the inactive payees which cannot check on-chain status and broadcast transactions. Maybe the payee is a smart contract which cannot be active, or maybe it is a real person who cannot get online, such as an author who uses ElfinHost Access-Control protocol to publish videos."}),(0,x.jsx)("p",{children:"The payer and PaymentJudger follow these steps:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"The payer sign a Bitcoin Cash transaction that pays the payee and has an OP_RETURN output contains the possibility that this transaction would be broadcasted."}),(0,x.jsxs)("li",{children:["The enclave receives this transaction, verifies it using ",(0,x.jsx)("cite",{children:"testmempoolaccept"}),", and sends the payer a signature endorsing the payer, the payee, the amount, the possibility, etc."]}),(0,x.jsx)("li",{children:"The enclave generate a VRF output based on the transaction\u2019s hashid and decide whether to broadcast this tx based on the specified possibility. The VRF output and the proof are also sent to the payer, no matter whether the tx is broadcasted or not."})]}),(0,x.jsxs)("p",{children:["The payer-signed Bitcoin Cash transaction must be a \u201cderivable\u201d transaction from which the ",(0,x.jsx)("a",{className:"reference external",href:"https://github.com/elfinguard/utxoadapter",children:"UTXO adaptor"})," can derive an EVM transaction containing one EVM log. Further more, the first OP_RETURN output\u2019s must have at least seven pushed data elements and the seventh must be a two-byte integer indicating the probability of the payment."]}),(0,x.jsxs)("p",{children:["PaymentJudger will serialize and sign the derived EVM log in the same way as the authorizer does: serialize the following solidity struct using ",(0,x.jsx)("cite",{children:"abi.encodePacked"})," and sign it using ",(0,x.jsx)("cite",{children:"personal_sign"}),"."]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"kt",children:"struct"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"LogInfo"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"{"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"chainId"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// which chain did this log happen on?"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"uint"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"timestamp"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// when did this log happend at?"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"address"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"sourceContract"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// which contract generates this log?"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes32"}),(0,x.jsx)("span",{className:"p",children:"[]"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"topics",(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// a log has 0~4 topics"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"    "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"data"}),(0,x.jsx)("span",{className:"p",children:";"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"c1",children:"// a log has variable-length data"}),"\n",(0,x.jsx)("span",{className:"p",children:"}"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n"]})})}),(0,x.jsxs)("p",{children:["According to the UTXO adaptor\u2019s specification, the ",(0,x.jsx)("cite",{children:"data"})," field of ",(0,x.jsx)("cite",{children:"LogInfo"})," can be decoded in following way:"]}),(0,x.jsx)("div",{className:"highlight-solidity notranslate",children:(0,x.jsx)("div",{className:"highlight",children:(0,x.jsxs)("pre",{children:[(0,x.jsx)("span",{}),(0,x.jsx)("span",{className:"p",children:"("}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"        "}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"nv",children:"_confirmations"}),(0,x.jsx)("span",{className:"p",children:","}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"        "}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:"p",children:"[]"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"memory"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"outputs",(0,x.jsx)("span",{className:"p",children:","}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"        "}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:"p",children:"[]"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"memory"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"inputs",(0,x.jsx)("span",{className:"p",children:","}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:" -WhiteSpace",children:"        "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:"p",children:"[]"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"memory"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"otherData",(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n",(0,x.jsx)("span",{className:"p",children:")"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"o",children:"="}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),"abi",(0,x.jsx)("span",{className:"p",children:"."}),"decode",(0,x.jsx)("span",{className:"p",children:"("}),"logInfo",(0,x.jsx)("span",{className:"p",children:"."}),"data",(0,x.jsx)("span",{className:"p",children:","}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"p",children:"("}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:"p",children:","}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:"p",children:"[],"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"uint256"}),(0,x.jsx)("span",{className:"p",children:"[],"}),(0,x.jsx)("span",{className:" -WhiteSpace",children:" "}),(0,x.jsx)("span",{className:"kt",children:"bytes"}),(0,x.jsx)("span",{className:"p",children:"[]));"}),(0,x.jsx)("span",{className:" -WhiteSpace"}),"\n"]})})}),(0,x.jsxs)("p",{children:["The possibility of payment is encoded in ",(0,x.jsx)("cite",{children:"otherData[0]"}),", which is the seventh data element of the first OP_RETURN output."]}),(0,x.jsx)("p",{children:"PaymentJudger will return the following information to payee:"}),(0,x.jsxs)("ol",{className:"arabic simple",children:[(0,x.jsx)("li",{children:"Prob16, the possibility of payment. It\u2019s in the range of [0, 65535]"}),(0,x.jsx)("li",{children:"Rand16: a peusdo random number from beta[30:]. It\u2019s in the range of [0, 65535]"}),(0,x.jsx)("li",{children:"VrfAlpha: the hashid of the transaction,"}),(0,x.jsx)("li",{children:"VrfBeta:  the VRF output,"}),(0,x.jsx)("li",{children:"VrfPi:    the VRF proof,"}),(0,x.jsx)("li",{children:"LogInfo:  serialized struct LogInfo,"}),(0,x.jsx)("li",{children:"LogSig:   a signature endorsing LogInfo,"})]}),(0,x.jsx)("p",{children:"If Rand16 is less than Prob16, this transaction will be broadcasted by PaymentJudger."})]})]})]}),(0,x.jsxs)(j,{className:"mt-[0.2rem] flex-row items-center justify-start",children:[(0,x.jsx)("img",{className:"ml-[0.14rem] mr-[0.24rem] w-[0.16rem] h-[0.16rem]",src:"image/750/learn/\u4e0b\u8f7d.png"}),"Download Whitepaper"]})]})})})]})})}}}]);
//# sourceMappingURL=77.8166d695.chunk.js.map